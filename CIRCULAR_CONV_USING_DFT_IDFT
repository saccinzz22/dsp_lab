#include <stdio.h>
#include <math.h>

#define N 4
#define PI 3.14159265f

void dft(float *in, int N, float *XR, float *XI){
    int k, n;
    for(k = 0; k < N; k++){
        XR[k] = 0;
        XI[k] = 0;
        for(n = 0; n < N; n++){
            float angle = 2 * PI * n * k / N;
            XR[k] += in[n] * cos(angle);
            XI[k] -= in[n] * sin(angle);
        }
    }
}

void idft(float *XR, float *XI, int N, float *out){
    int n, k;
    for(n = 0; n < N; n++){
        out[n] = 0;
        for(k = 0; k < N; k++){
            float angle = 2 * PI * k * n / N;
            out[n] += XR[k] * cos(angle) - XI[k] * sin(angle);
        }
        out[n] /= N;
    }
}

int main(void){
    float x[N] = {1, 2, 3, 4};
    float h[N] = {1, 1, 1, 1};
    float XR[N], XI[N], HR[N], HI[N];
    float YR[N], YI[N];
    float y[N];
    int i;

    dft(x, N, XR, XI);
    dft(h, N, HR, HI);

    for(i = 0; i < N; i++){
        YR[i] = XR[i] * HR[i] - XI[i] * HI[i];
        YI[i] = XR[i] * HI[i] + XI[i] * HR[i];
    }

    idft(YR, YI, N, y);

    for(i = 0; i < N; i++){
        printf("Circular conv y[%d] = %f\n", i, y[i]);
    }

    return 0;
}
